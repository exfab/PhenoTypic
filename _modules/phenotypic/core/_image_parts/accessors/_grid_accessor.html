
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>phenotypic.core._image_parts.accessors._grid_accessor &#8212; PhenoTypic</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=800a184d" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../../_static/documentation_options.js?v=b3db6a4d"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/phenotypic/core/_image_parts/accessors/_grid_accessor';</script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.11.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
     
  

<a class="navbar-brand logo" href="../../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../_static/gradient_logo_exfab.svg" class="logo__image only-light" alt="PhenoTypic"/>
    <img src="../../../../../_static/gradient_logo_exfab.svg" class="logo__image only-dark pst-js-only" alt="PhenoTypic"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../api_reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../contrib_guide/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../downloadables.html">
    Downloads
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Wheeldon-Lab/PhenoScope#" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../api_reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../contrib_guide/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../downloadables.html">
    Downloads
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Wheeldon-Lab/PhenoScope#" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">phenotypic.core._image_parts.accessors._grid_accessor</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for phenotypic.core._image_parts.accessors._grid_accessor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span> <span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridImage</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">skimage.color</span><span class="w"> </span><span class="kn">import</span> <span class="n">label2rgb</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">phenotypic</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic.core._image_parts.accessor_abstracts</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageAccessorBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic.tools.constants_</span><span class="w"> </span><span class="kn">import</span> <span class="n">METADATA</span><span class="p">,</span> <span class="n">IMAGE_TYPES</span><span class="p">,</span> <span class="n">BBOX</span><span class="p">,</span> <span class="n">GRID</span><span class="p">,</span> <span class="n">OBJECT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic.tools.exceptions_</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoObjectsError</span>


<div class="viewcode-block" id="GridAccessor">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GridAccessor</span><span class="p">(</span><span class="n">ImageAccessorBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides grid-based access and analysis for microbial colony arrays on agar plates.</span>

<span class="sd">    This class facilitates operations on grid structures within a GridImage, enabling analysis</span>
<span class="sd">    of robotically-pinned microbial colonies arranged in a regular rectangular array pattern.</span>
<span class="sd">    It provides methods for determining grid properties, retrieving colony information by grid</span>
<span class="sd">    location, and visualizing grid overlays with row and column assignments.</span>

<span class="sd">    The grid divides an agar plate image into a regular matrix of sections, each potentially</span>
<span class="sd">    containing one or more detected colonies. The grid is ordered left-to-right, top-to-bottom</span>
<span class="sd">    when using flattened indexing.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nrows (int): Number of rows in the grid (read/write property). Corresponds to the</span>
<span class="sd">            number of row pins in a colony pinning robot. Must be &gt;= 1.</span>
<span class="sd">        ncols (int): Number of columns in the grid (read/write property). Corresponds to the</span>
<span class="sd">            number of column pins in a colony pinning robot. Must be &gt;= 1.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Access grid information for a 96-well colony plate (8 rows x 12 columns):</span>

<span class="sd">        ```python</span>
<span class="sd">        from phenotypic import GridImage</span>

<span class="sd">        # Load image and create grid accessor</span>
<span class="sd">        grid_image = GridImage(&#39;agar_plate.png&#39;, nrows=8, ncols=12)</span>

<span class="sd">        # Get grid information as a DataFrame</span>
<span class="sd">        grid_info = grid_image.grid.info()</span>
<span class="sd">        print(f&quot;Found {len(grid_info)} colonies across {grid_image.grid.nrows} rows &quot;</span>
<span class="sd">              f&quot;and {grid_image.grid.ncols} columns&quot;)</span>

<span class="sd">        # Extract a single grid section (colony at row 2, column 3)</span>
<span class="sd">        section_idx = 2 * grid_image.grid.ncols + 3  # Flattened index</span>
<span class="sd">        colony_image = grid_image.grid[section_idx]</span>

<span class="sd">        # Visualize grid columns with color-coded labels</span>
<span class="sd">        fig, ax = grid_image.grid.show_column_overlay(show_gridlines=True)</span>
<span class="sd">        ```</span>

<span class="sd">        Get colony counts by grid section:</span>

<span class="sd">        ```python</span>
<span class="sd">        # Count colonies in each grid section</span>
<span class="sd">        section_counts = grid_image.grid.get_section_counts(ascending=False)</span>
<span class="sd">        print(&quot;Colonies per section (sorted):&quot;)</span>
<span class="sd">        print(section_counts)</span>

<span class="sd">        # Get all colony information for row 0</span>
<span class="sd">        row_info = grid_image.grid.get_info_by_section((0, slice(None)))</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_image</span><span class="p">:</span> <span class="n">GridImage</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="p">:</span> <span class="n">GridImage</span> <span class="o">=</span> <span class="n">root_image</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nrows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of rows in the grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Number of rows in the grid array. Must be &gt;= 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">nrows</span>

    <span class="nd">@nrows</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nrows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrows</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the number of rows in the grid.</span>

<span class="sd">        Args:</span>
<span class="sd">            nrows (int): Number of rows. Must be a positive integer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If nrows &lt; 1.</span>
<span class="sd">            TypeError: If nrows is not an integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nrows</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Number of nrows must be greater than 0&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nrows</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Number of nrows must be an integer&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="n">nrows</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ncols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of columns in the grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Number of columns in the grid array. Must be &gt;= 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">ncols</span>

    <span class="nd">@ncols</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ncols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the number of columns in the grid.</span>

<span class="sd">        Args:</span>
<span class="sd">            ncols (int): Number of columns. Must be a positive integer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If ncols &lt; 1.</span>
<span class="sd">            TypeError: If ncols is not an integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ncols</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Number of columns must be greater than 0&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Number of columns must be an integer&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span>

<div class="viewcode-block" id="GridAccessor.info">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get grid information for all detected colonies.</span>

<span class="sd">        Returns a DataFrame with bounding box measurements and grid location (row, column,</span>
<span class="sd">        section) assignments for each detected object (colony). This is the primary method</span>
<span class="sd">        for accessing detailed colony positioning and measurement data.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_metadata (bool, optional): Whether to include image metadata columns</span>
<span class="sd">                in the output DataFrame. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with one row per detected colony. Columns include:</span>
<span class="sd">                - ObjectLabel: Unique identifier for the colony</span>
<span class="sd">                - CenterRR, CenterCC: Row and column coordinates of colony center</span>
<span class="sd">                - MinRR, MaxRR, MinCC, MaxCC: Bounding box coordinates</span>
<span class="sd">                - RowNum: Grid row index (0-indexed)</span>
<span class="sd">                - ColNum: Grid column index (0-indexed)</span>
<span class="sd">                - SectionNum: Flattened grid section index (0 to nrows*ncols-1)</span>
<span class="sd">                - Additional columns if include_metadata=True</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Get full grid information</span>
<span class="sd">            grid_info = grid_image.grid.info()</span>

<span class="sd">            # Count colonies by row</span>
<span class="sd">            colonies_per_row = grid_info.groupby(&#39;RowNum&#39;).size()</span>

<span class="sd">            # Find largest colony in grid section 10</span>
<span class="sd">            section_10 = grid_info[grid_info[&#39;SectionNum&#39;] == 10]</span>
<span class="sd">            largest = section_10.loc[section_10[&#39;Area&#39;].idxmax()]</span>

<span class="sd">            # Get colonies without metadata</span>
<span class="sd">            grid_info_minimal = grid_image.grid.info(include_metadata=False)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_metadata</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">insert_metadata</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">info</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_idx_ref_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal property: matrix mapping grid positions to flattened indices.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: 2D array of shape (nrows, ncols) where element [i, j] contains</span>
<span class="sd">                the flattened index for that grid position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">),</span> <span class="n">newshape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">))</span>

<div class="viewcode-block" id="GridAccessor.__getitem__">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.__getitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract a grid section as a subimage.</span>

<span class="sd">        Returns a cropped image corresponding to a specific grid section based on either</span>
<span class="sd">        its flattened index or a (row, column) grid coordinate. The grid is indexed</span>
<span class="sd">        left-to-right, top-to-bottom (row-major order). Only objects belonging to the</span>
<span class="sd">        specified grid section are included in the subimage.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int | tuple[int, int]): Grid section identifier.</span>
<span class="sd">                - If int: flattened grid section index, ranging from 0 to</span>
<span class="sd">                  ``nrows * ncols - 1``. For an 8x12 grid: section 0 is top-left,</span>
<span class="sd">                  section 11 is top-right, section 84 is bottom-left,</span>
<span class="sd">                  section 95 is bottom-right.</span>
<span class="sd">                - If tuple: ``(row_index, col_index)`` pair specifying the grid</span>
<span class="sd">                  location, with both indices 0-based.</span>

<span class="sd">        Returns:</span>
<span class="sd">            phenotypic.Image: A subimage containing the grid section. Pixel coordinates</span>
<span class="sd">                are adjusted to the section origin. Object labels are preserved for objects</span>
<span class="sd">                belonging to this section only; other objects are removed (label set to 0).</span>
<span class="sd">                If no objects are present in the parent image, returns a copy of the entire</span>
<span class="sd">                parent image.</span>

<span class="sd">        Raises:</span>
<span class="sd">            IndexError: If idx is out of bounds (for either flattened or</span>
<span class="sd">                ``(row, col)`` indexing), or if a tuple index does not have</span>
<span class="sd">                length 2.</span>

<span class="sd">        Examples:</span>

<span class="sd">            ```python</span>
<span class="sd">            # Extract top-left grid section (row 0, col 0)</span>
<span class="sd">            top_left = grid_image.grid[0]</span>
<span class="sd">            print(f&quot;Section size: {top_left.shape}&quot;)</span>

<span class="sd">            # Extract center section for an 8x12 grid (row 4, col 6)</span>
<span class="sd">            # Using flattened index</span>
<span class="sd">            center_idx = 4 * 12 + 6  # = 54</span>
<span class="sd">            center_section = grid_image.grid[center_idx]</span>

<span class="sd">            # The same section accessed using (row, col) indexing</span>
<span class="sd">            center_section_2 = grid_image.grid[4, 6]</span>

<span class="sd">            # Process colonies in top row (row 0, columns 0-11)</span>
<span class="sd">            for col in range(grid_image.grid.ncols):</span>
<span class="sd">                # Access by (row, col) index</span>
<span class="sd">                section = grid_image.grid[0, col]</span>
<span class="sd">                analyze_colony(section)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Allow access either by flattened index or by (row, col) tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Grid section index tuple must have length 2: (row, col).&#39;</span><span class="p">)</span>
            <span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="c1"># This will naturally raise IndexError for out-of-range indices</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx_ref_matrix</span><span class="p">[</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">num_objects</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">min_coords</span><span class="p">,</span> <span class="n">max_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adv_get_grid_section_slices</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">min_rr</span><span class="p">,</span> <span class="n">min_cc</span> <span class="o">=</span> <span class="n">min_coords</span>
            <span class="n">max_rr</span><span class="p">,</span> <span class="n">max_cc</span> <span class="o">=</span> <span class="n">max_coords</span>

            <span class="n">section_image</span> <span class="o">=</span> <span class="n">phenotypic</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">min_rr</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">max_rr</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_cc</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">max_cc</span><span class="p">)])</span>

            <span class="c1"># Remove objects that don&#39;t belong in that grid section from the subimage</span>
            <span class="n">objmap</span> <span class="o">=</span> <span class="n">section_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:]</span>
            <span class="n">objmap</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">objmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_section_labels</span><span class="p">(</span><span class="n">idx</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">section_image</span><span class="o">.</span><span class="n">objmap</span> <span class="o">=</span> <span class="n">objmap</span>
            <span class="n">section_image</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">METADATA</span><span class="o">.</span><span class="n">IMAGE_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMAGE_TYPES</span><span class="o">.</span><span class="n">GRID_SECTION</span><span class="o">.</span><span class="n">value</span>

            <span class="k">return</span> <span class="n">section_image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">phenotypic</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridAccessor.get_centroid_alignment_info">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_centroid_alignment_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_centroid_alignment_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate linear regression fit for colony centroids along a grid axis.</span>

<span class="sd">        Computes the slope and intercept of a best-fit line through the centroids of</span>
<span class="sd">        colonies arranged along a specified axis (rows or columns). This quantifies</span>
<span class="sd">        alignment quality and any systematic drift in the pinned colony array.</span>

<span class="sd">        The linear regression uses the standard least-squares method (2D covariance/variance)</span>
<span class="sd">        to find the best-fit line: y = m*x + b.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis (int): Axis along which to compute alignment:</span>
<span class="sd">                - 0: Row-wise alignment. For each row, finds how colony centers vary</span>
<span class="sd">                  along the column (CC) axis as a function of their column index.</span>
<span class="sd">                - 1: Column-wise alignment. For each column, finds how colony centers</span>
<span class="sd">                  vary along the row (RR) axis as a function of their row index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[np.ndarray[float], np.ndarray[int]]: A tuple containing:</span>
<span class="sd">                - m_slope (np.ndarray): Slopes for each row/column (length nrows or ncols).</span>
<span class="sd">                  NaN indicates no colonies in that row/column.</span>
<span class="sd">                - b_intercept (np.ndarray): Y-intercepts, rounded to nearest integer.</span>
<span class="sd">                  NaN indicates no colonies in that row/column.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NoObjectsError: If the parent image contains no detected objects (colonies).</span>
<span class="sd">            ValueError: If axis is not 0 or 1.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Check row alignment (how much do colonies shift left-right across their row?)</span>
<span class="sd">            row_slopes, row_intercepts = grid_image.grid.get_centroid_alignment_info(axis=0)</span>
<span class="sd">            print(f&quot;Row alignment slopes (pixels/column): {row_slopes}&quot;)</span>

<span class="sd">            # Check column alignment (how much do colonies shift top-bottom across their column?)</span>
<span class="sd">            col_slopes, col_intercepts = grid_image.grid.get_centroid_alignment_info(axis=1)</span>

<span class="sd">            # Identify problematic rows with high drift</span>
<span class="sd">            drift_threshold = 0.05  # pixels per grid position</span>
<span class="sd">            problematic_rows = np.where(np.abs(row_slopes) &gt; drift_threshold)[0]</span>
<span class="sd">            print(f&quot;Rows with significant drift: {problematic_rows}&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">num_objects</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoObjectsError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
            <span class="n">x_group</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">ROW_NUM</span><span class="p">)</span>
            <span class="n">x_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">CENTER_CC</span><span class="p">)</span>
            <span class="n">y_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">CENTER_RR</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">num_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
            <span class="n">x_group</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">COL_NUM</span><span class="p">)</span>
            <span class="n">x_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">CENTER_RR</span><span class="p">)</span>
            <span class="n">y_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">CENTER_CC</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Axis should be 0 or 1.&#39;</span><span class="p">)</span>

        <span class="c1"># create persistent grid_info</span>
        <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

        <span class="c1"># allocate empty vectors to store m &amp; b for all values</span>
        <span class="n">m_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">num_vectors</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">b_intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">num_vectors</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="c1"># Collect slope &amp; intercept for the nrows or columns</span>
        <span class="c1"># Use 2D covariance/variance method for finding linear regression</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vectors</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">x_group</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x_val</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">x_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">y</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">x_group</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">,</span> <span class="n">y_val</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">y_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">covariance</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_mean</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_mean</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">variance</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">m_slope</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">covariance</span><span class="o">/</span><span class="n">variance</span>
                <span class="n">b_intercept</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">-</span> <span class="n">m_slope</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">*</span><span class="n">x_mean</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m_slope</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">b_intercept</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x_mean</span>

        <span class="k">return</span> <span class="n">m_slope</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">b_intercept</span><span class="p">)</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grid Columns</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GridAccessor.get_col_edges">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_col_edges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_col_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the column boundary positions in pixel coordinates.</span>

<span class="sd">        Returns the x-coordinates (column indices) that define the vertical boundaries</span>
<span class="sd">        of each grid column. For an ncols-column grid, returns ncols+1 values representing</span>
<span class="sd">        the left edge of column 0, boundaries between adjacent columns, and the right edge</span>
<span class="sd">        of column ncols-1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: 1D array of column edge positions (pixel column indices).</span>
<span class="sd">                Length is ncols+1. Values are in ascending order.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            col_edges = grid_image.grid.get_col_edges()</span>
<span class="sd">            print(f&quot;Column edges: {col_edges}&quot;)</span>
<span class="sd">            # Output: [0.0, 106.5, 213.0, 319.5, ...]  for a 12-column grid</span>

<span class="sd">            # Calculate column width</span>
<span class="sd">            col_width = col_edges[1] - col_edges[0]</span>
<span class="sd">            print(f&quot;Column width: {col_width} pixels&quot;)</span>

<span class="sd">            # Extract pixels for column 3</span>
<span class="sd">            col_3_min, col_3_max = int(col_edges[3]), int(col_edges[4])</span>
<span class="sd">            column_3_data = grid_image.gray[:, col_3_min:col_3_max]</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">get_col_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridAccessor.get_col_map">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_col_map">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_col_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an object map with objects labeled by their grid column number.</span>

<span class="sd">        Creates a copy of the object map where each detected colony is relabeled according</span>
<span class="sd">        to its grid column assignment. This is useful for visualizing or analyzing all</span>
<span class="sd">        colonies in a particular column together.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: 2D integer array with same shape as the parent image. Each pixel</span>
<span class="sd">                belonging to a colony is set to that colony&#39;s grid column number (1-indexed,</span>
<span class="sd">                ranging from 1 to ncols). Pixels not belonging to any colony are 0.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            col_map = grid_image.grid.get_col_map()</span>

<span class="sd">            # All colonies in column 0 have value 1, column 1 have value 2, etc.</span>
<span class="sd">            print(f&quot;Unique values in col_map: {np.unique(col_map)}&quot;)</span>
<span class="sd">            # Output: [0, 1, 2, 3, ..., 12]  for a 12-column grid</span>

<span class="sd">            # Count total pixels belonging to each column</span>
<span class="sd">            for col_num in range(1, grid_image.grid.ncols + 1):</span>
<span class="sd">                col_pixels = np.sum(col_map == col_num)</span>
<span class="sd">                print(f&quot;Column {col_num}: {col_pixels} pixels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">col_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">col_bidx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">COL_NUM</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
            <span class="n">subtable</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">COL_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">col_bidx</span><span class="p">,</span> <span class="p">:]</span>

            <span class="c1"># Edit the new map&#39;s objects to equal the column number</span>
            <span class="n">col_map</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">element</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:],</span>
                    <span class="n">test_elements</span><span class="o">=</span><span class="n">subtable</span><span class="p">[</span><span class="n">OBJECT</span><span class="o">.</span><span class="n">LABEL</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="p">)]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">col_map</span></div>


<div class="viewcode-block" id="GridAccessor.show_column_overlay">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.show_column_overlay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_column_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_enhanced</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_gridlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize colonies with column-based color coding and optional grid overlay.</span>

<span class="sd">        Displays the image with an overlay showing each colony colored by its grid column.</span>
<span class="sd">        This helps visualize the column structure of the pinned array and identify any</span>
<span class="sd">        column-wise positioning issues.</span>

<span class="sd">        Args:</span>
<span class="sd">            use_enhanced (bool, optional): If True, use the enhanced grayscale version</span>
<span class="sd">                of the image for better visibility. Defaults to False.</span>
<span class="sd">            show_gridlines (bool, optional): If True, overlay cyan dashed lines marking</span>
<span class="sd">                the grid column and row boundaries. Defaults to True.</span>
<span class="sd">            ax (plt.Axes, optional): Existing Matplotlib Axes to plot into. If None,</span>
<span class="sd">                a new figure and axes are created. Defaults to None.</span>
<span class="sd">            figsize (tuple[int, int], optional): Figure size as (width, height) in inches.</span>
<span class="sd">                Only used if ax is None. Defaults to (9, 10).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[plt.Figure, plt.Axes]: Matplotlib Figure and Axes objects. If ax was</span>
<span class="sd">                provided as input, ax is returned instead of the original input value.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Display column overlay with gridlines</span>
<span class="sd">            fig, ax = grid_image.grid.show_column_overlay(show_gridlines=True)</span>
<span class="sd">            plt.title(&quot;Colony Array - Column Overlay&quot;)</span>
<span class="sd">            plt.show()</span>

<span class="sd">            # Use enhanced image for better contrast</span>
<span class="sd">            fig, ax = grid_image.grid.show_column_overlay(</span>
<span class="sd">                use_enhanced=True,</span>
<span class="sd">                show_gridlines=True,</span>
<span class="sd">                figsize=(12, 14)</span>
<span class="sd">            )</span>

<span class="sd">            # Plot on existing axes</span>
<span class="sd">            fig, axes = plt.subplots(1, 2, figsize=(16, 10))</span>
<span class="sd">            grid_image.grid.show_column_overlay(ax=axes[0])</span>
<span class="sd">            grid_image.grid.show_row_overlay(ax=axes[1])</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">func_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_ax</span> <span class="o">=</span> <span class="n">ax</span>

        <span class="n">func_ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_enhanced</span><span class="p">:</span>
            <span class="n">func_ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">label2rgb</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_col_map</span><span class="p">(),</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">enh_gray</span><span class="p">[:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">label2rgb</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_col_map</span><span class="p">(),</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">gray</span><span class="p">[:]))</span>

        <span class="k">if</span> <span class="n">show_gridlines</span><span class="p">:</span>
            <span class="n">col_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_col_edges</span><span class="p">()</span>
            <span class="n">row_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_row_edges</span><span class="p">()</span>
            <span class="n">func_ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">col_edges</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">row_edges</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ymax</span><span class="o">=</span><span class="n">row_edges</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grid Rows</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GridAccessor.get_row_edges">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_row_edges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_row_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the row boundary positions in pixel coordinates.</span>

<span class="sd">        Returns the y-coordinates (row indices) that define the horizontal boundaries</span>
<span class="sd">        of each grid row. For an nrows-row grid, returns nrows+1 values representing</span>
<span class="sd">        the top edge of row 0, boundaries between adjacent rows, and the bottom edge</span>
<span class="sd">        of row nrows-1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: 1D array of row edge positions (pixel row indices).</span>
<span class="sd">                Length is nrows+1. Values are in ascending order.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            row_edges = grid_image.grid.get_row_edges()</span>
<span class="sd">            print(f&quot;Row edges: {row_edges}&quot;)</span>
<span class="sd">            # Output: [0.0, 95.2, 190.4, 285.6, ...]  for an 8-row grid</span>

<span class="sd">            # Calculate row height</span>
<span class="sd">            row_height = row_edges[1] - row_edges[0]</span>
<span class="sd">            print(f&quot;Row height: {row_height} pixels&quot;)</span>

<span class="sd">            # Extract pixels for row 4</span>
<span class="sd">            row_4_min, row_4_max = int(row_edges[4]), int(row_edges[5])</span>
<span class="sd">            row_4_data = grid_image.gray[row_4_min:row_4_max, :]</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">grid_finder</span><span class="o">.</span><span class="n">get_row_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridAccessor.get_row_map">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_row_map">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_row_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an object map with objects labeled by their grid row number.</span>

<span class="sd">        Creates a copy of the object map where each detected colony is relabeled according</span>
<span class="sd">        to its grid row assignment. This is useful for visualizing or analyzing all</span>
<span class="sd">        colonies in a particular row together.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: 2D integer array with same shape as the parent image. Each pixel</span>
<span class="sd">                belonging to a colony is set to that colony&#39;s grid row number (1-indexed,</span>
<span class="sd">                ranging from 1 to nrows). Pixels not belonging to any colony are 0.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            row_map = grid_image.grid.get_row_map()</span>

<span class="sd">            # All colonies in row 0 have value 1, row 1 have value 2, etc.</span>
<span class="sd">            print(f&quot;Unique values in row_map: {np.unique(row_map)}&quot;)</span>
<span class="sd">            # Output: [0, 1, 2, 3, ..., 8]  for an 8-row grid</span>

<span class="sd">            # Count total pixels belonging to each row</span>
<span class="sd">            for row_num in range(1, grid_image.grid.nrows + 1):</span>
<span class="sd">                row_pixels = np.sum(row_map == row_num)</span>
<span class="sd">                print(f&quot;Row {row_num}: {row_pixels} pixels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">row_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">col_bidx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">ROW_NUM</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
            <span class="n">subtable</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">ROW_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">col_bidx</span><span class="p">,</span> <span class="p">:]</span>

            <span class="c1"># Edit the new map&#39;s objects to equal the column number</span>
            <span class="n">row_map</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                        <span class="n">element</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:],</span>
                        <span class="n">test_elements</span><span class="o">=</span><span class="n">subtable</span><span class="p">[</span><span class="n">OBJECT</span><span class="o">.</span><span class="n">LABEL</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">row_map</span></div>


<div class="viewcode-block" id="GridAccessor.show_row_overlay">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.show_row_overlay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_row_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_enhanced</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_gridlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize colonies with row-based color coding and optional grid overlay.</span>

<span class="sd">        Displays the image with an overlay showing each colony colored by its grid row.</span>
<span class="sd">        This helps visualize the row structure of the pinned array and identify any</span>
<span class="sd">        row-wise positioning issues.</span>

<span class="sd">        Args:</span>
<span class="sd">            use_enhanced (bool, optional): If True, use the enhanced grayscale version</span>
<span class="sd">                of the image for better visibility. Defaults to False.</span>
<span class="sd">            show_gridlines (bool, optional): If True, overlay cyan dashed lines marking</span>
<span class="sd">                the grid row and column boundaries. Defaults to True.</span>
<span class="sd">            ax (plt.Axes, optional): Existing Matplotlib Axes to plot into. If None,</span>
<span class="sd">                a new figure and axes are created. Defaults to None.</span>
<span class="sd">            figsize (tuple[int, int], optional): Figure size as (width, height) in inches.</span>
<span class="sd">                Only used if ax is None. Defaults to (9, 10).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[plt.Figure, plt.Axes]: Matplotlib Figure and Axes objects. If ax was</span>
<span class="sd">                provided as input, only the axes are returned.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Display row overlay with gridlines</span>
<span class="sd">            fig, ax = grid_image.grid.show_row_overlay(show_gridlines=True)</span>
<span class="sd">            plt.title(&quot;Colony Array - Row Overlay&quot;)</span>
<span class="sd">            plt.show()</span>

<span class="sd">            # Use enhanced image for better contrast</span>
<span class="sd">            fig, ax = grid_image.grid.show_row_overlay(</span>
<span class="sd">                use_enhanced=True,</span>
<span class="sd">                show_gridlines=True,</span>
<span class="sd">                figsize=(12, 14)</span>
<span class="sd">            )</span>

<span class="sd">            # Create side-by-side comparison</span>
<span class="sd">            fig, axes = plt.subplots(1, 2, figsize=(16, 10))</span>
<span class="sd">            grid_image.grid.show_column_overlay(ax=axes[0])</span>
<span class="sd">            grid_image.grid.show_row_overlay(ax=axes[1])</span>
<span class="sd">            plt.suptitle(&quot;Column vs Row Grid Visualization&quot;)</span>
<span class="sd">            plt.show()</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">func_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_ax</span> <span class="o">=</span> <span class="n">ax</span>

        <span class="n">func_ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_enhanced</span><span class="p">:</span>
            <span class="n">func_ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">label2rgb</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_row_map</span><span class="p">(),</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">enh_gray</span><span class="p">[:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">label2rgb</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_row_map</span><span class="p">(),</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">gray</span><span class="p">[:]))</span>

        <span class="k">if</span> <span class="n">show_gridlines</span><span class="p">:</span>
            <span class="n">col_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_col_edges</span><span class="p">()</span>
            <span class="n">row_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_row_edges</span><span class="p">()</span>
            <span class="n">func_ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">row_edges</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">col_edges</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">col_edges</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">func_ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func_ax</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grid Sections</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GridAccessor.get_section_map">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_section_map">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_section_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an object map with objects labeled by their grid section number.</span>

<span class="sd">        Creates a copy of the object map where each detected colony is relabeled according</span>
<span class="sd">        to its grid section assignment (flattened grid index). Section numbering is 0-indexed,</span>
<span class="sd">        ordered left-to-right, top-to-bottom.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: 2D integer array with same shape as the parent image. Each pixel</span>
<span class="sd">                belonging to a colony is set to that colony&#39;s grid section number (0-indexed,</span>
<span class="sd">                ranging from 0 to nrows*ncols-1). Pixels not belonging to any colony are 0.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            section_map = grid_image.grid.get_section_map()</span>

<span class="sd">            # For an 8x12 grid:</span>
<span class="sd">            # Section 0: top-left (row 0, col 0)</span>
<span class="sd">            # Section 11: top-right (row 0, col 11)</span>
<span class="sd">            # Section 84: bottom-left (row 7, col 0)</span>
<span class="sd">            # Section 95: bottom-right (row 7, col 11)</span>

<span class="sd">            # Identify empty sections</span>
<span class="sd">            empty_sections = []</span>
<span class="sd">            for section_num in range(grid_image.grid.nrows * grid_image.grid.ncols):</span>
<span class="sd">                if np.sum(section_map == section_num) == 0:</span>
<span class="sd">                    empty_sections.append(section_num)</span>
<span class="sd">            print(f&quot;Empty sections: {empty_sections}&quot;)</span>

<span class="sd">            # Visualize section distribution</span>
<span class="sd">            from skimage.color import label2rgb</span>
<span class="sd">            colored_sections = label2rgb(label=section_map, image=grid_image.gray[:])</span>
<span class="sd">            plt.imshow(colored_sections)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

        <span class="n">section_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">bidx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">GRID</span><span class="o">.</span><span class="n">SECTION_NUM</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
            <span class="n">subtable</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">GRID</span><span class="o">.</span><span class="n">SECTION_NUM</span><span class="p">]</span> <span class="o">==</span> <span class="n">bidx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">section_map</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">element</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:],</span>
                    <span class="n">test_elements</span><span class="o">=</span><span class="n">subtable</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">OBJECT</span><span class="o">.</span><span class="n">LABEL</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="p">)]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">section_map</span></div>


<div class="viewcode-block" id="GridAccessor.get_section_counts">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_section_counts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_section_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count the number of objects (colonies) in each grid section.</span>

<span class="sd">        Returns a Series showing how many colonies were detected in each grid section.</span>
<span class="sd">        Useful for quality control to identify problematic sections with unexpected</span>
<span class="sd">        colony counts (e.g., empty sections, multiple colonies in single pinned location).</span>

<span class="sd">        Args:</span>
<span class="sd">            ascending (bool, optional): If False (default), sort counts in descending order</span>
<span class="sd">                (sections with most colonies first). If True, sort ascending (fewest first).</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Series: A pandas Series where:</span>
<span class="sd">                - Index: Grid section number (0 to nrows*ncols-1)</span>
<span class="sd">                - Values: Count of colonies in that section</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            section_counts = grid_image.grid.get_section_counts()</span>

<span class="sd">            # Find sections with multiple colonies (potential pinning errors)</span>
<span class="sd">            problem_sections = section_counts[section_counts &gt; 1]</span>
<span class="sd">            print(f&quot;Sections with multiple colonies: {problem_sections}&quot;)</span>
<span class="sd">            # Output:</span>
<span class="sd">            # SectionNum</span>
<span class="sd">            # 5      2</span>
<span class="sd">            # 12     3</span>
<span class="sd">            # dtype: int64</span>

<span class="sd">            # Find empty sections (no colony detected)</span>
<span class="sd">            expected_sections = set(range(grid_image.grid.nrows * grid_image.grid.ncols))</span>
<span class="sd">            detected_sections = set(section_counts.index)</span>
<span class="sd">            empty_sections = expected_sections - detected_sections</span>
<span class="sd">            print(f&quot;Empty sections: {empty_sections}&quot;)</span>

<span class="sd">            # Statistics on detection completeness</span>
<span class="sd">            num_expected = grid_image.grid.nrows * grid_image.grid.ncols</span>
<span class="sd">            num_detected = len(section_counts)</span>
<span class="sd">            completeness = 100 * num_detected / num_expected</span>
<span class="sd">            print(f&quot;Array completeness: {completeness:.1f}%&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">GRID</span><span class="o">.</span><span class="n">SECTION_NUM</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridAccessor.get_info_by_section">
<a class="viewcode-back" href="../../../../../api_reference/api/phenotypic.GridImage.grid.html#phenotypic.core._image_parts.accessors.GridAccessor.get_info_by_section">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_info_by_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get grid information for colonies in a specific grid section.</span>

<span class="sd">        Retrieves detailed colony information (bounding box, centroid, etc.) for all</span>
<span class="sd">        objects within a given grid section. The section can be specified either by</span>
<span class="sd">        flattened index or by (row, column) tuple.</span>

<span class="sd">        Args:</span>
<span class="sd">            section_number (int or tuple[int, int]): Grid section identifier:</span>
<span class="sd">                - If int: flattened section index (0 to nrows*ncols-1)</span>
<span class="sd">                - If tuple: (row_index, col_index) pair specifying the grid location</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with one row per colony in the specified section.</span>
<span class="sd">                Contains same columns as info() method. Empty DataFrame if section</span>
<span class="sd">                contains no colonies.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If section_number is neither an int nor a 2-tuple.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Get colonies using flattened index (section 25)</span>
<span class="sd">            section_info = grid_image.grid.get_info_by_section(25)</span>
<span class="sd">            print(f&quot;Colonies in section 25: {len(section_info)}&quot;)</span>

<span class="sd">            # Get colonies using (row, column) notation</span>
<span class="sd">            # Get colonies in grid position (row=2, col=5)</span>
<span class="sd">            section_info = grid_image.grid.get_info_by_section((2, 5))</span>

<span class="sd">            if len(section_info) &gt; 0:</span>
<span class="sd">                # Analyze properties of colonies in this section</span>
<span class="sd">                colony = section_info.iloc[0]</span>
<span class="sd">                print(f&quot;Colony area: {colony[&#39;Area&#39;]} pixels&quot;)</span>
<span class="sd">                print(f&quot;Colony center: ({colony[&#39;CenterRR&#39;]}, {colony[&#39;CenterCC&#39;]})&quot;)</span>
<span class="sd">            else:</span>
<span class="sd">                print(&quot;No colony detected in this section&quot;)</span>

<span class="sd">            # Find largest colony in section 10</span>
<span class="sd">            section_10 = grid_image.grid.get_info_by_section(10)</span>
<span class="sd">            if len(section_10) &gt; 0:</span>
<span class="sd">                largest = section_10.loc[section_10[&#39;Area&#39;].idxmax()]</span>
<span class="sd">                print(f&quot;Largest colony: label={largest.name}, area={largest[&#39;Area&#39;]}&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section_number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Access by section number</span>
            <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">SECTION_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">section_number</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section_number</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">section_number</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Access by row and col number</span>
            <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="n">grid_info</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">ROW_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">section_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
            <span class="k">return</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">ROW_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">section_number</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Section index should be int or a tuple of label_subset&#39;</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_naive_get_grid_section_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal method: get pixel slices for a grid section based on grid edges.</span>

<span class="sd">        Returns the exact pixel boundaries of a grid section without considering</span>
<span class="sd">        the actual objects within it. This may result in cropping objects that</span>
<span class="sd">        extend beyond the grid section boundaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): Flattened grid section index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Tuple[int, int], Tuple[int, int]]: ((min_row, min_col), (max_row, max_col))</span>
<span class="sd">                giving pixel coordinates for slicing the parent image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row_edges</span><span class="p">,</span> <span class="n">col_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_row_edges</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_col_edges</span><span class="p">()</span>
        <span class="n">row_pos</span><span class="p">,</span> <span class="n">col_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_idx_ref_matrix</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)</span>
        <span class="n">min_cc</span> <span class="o">=</span> <span class="n">col_edges</span><span class="p">[</span><span class="n">col_pos</span><span class="p">]</span>
        <span class="n">max_cc</span> <span class="o">=</span> <span class="n">col_edges</span><span class="p">[</span><span class="n">col_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">min_rr</span> <span class="o">=</span> <span class="n">row_edges</span><span class="p">[</span><span class="n">row_pos</span><span class="p">]</span>
        <span class="n">max_rr</span> <span class="o">=</span> <span class="n">row_edges</span><span class="p">[</span><span class="n">row_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">min_rr</span><span class="p">,</span> <span class="n">min_cc</span><span class="p">),</span> <span class="p">(</span><span class="n">max_rr</span><span class="p">,</span> <span class="n">max_cc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_adv_get_grid_section_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">((</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal method: get pixel slices for a grid section accounting for object boundaries.</span>

<span class="sd">        Returns pixel boundaries for a grid section, expanded if necessary to fully</span>
<span class="sd">        include all objects that belong to this section. This preserves complete</span>
<span class="sd">        objects that might extend slightly beyond the ideal grid boundaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): Flattened grid section index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Tuple[int, int], Tuple[int, int]]: ((min_row, min_col), (max_row, max_col))</span>
<span class="sd">                giving pixel coordinates for slicing the parent image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_min</span><span class="p">,</span> <span class="n">grid_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_naive_get_grid_section_slices</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">grid_min_rr</span><span class="p">,</span> <span class="n">grid_min_cc</span> <span class="o">=</span> <span class="n">grid_min</span>
        <span class="n">grid_max_rr</span><span class="p">,</span> <span class="n">grid_max_cc</span> <span class="o">=</span> <span class="n">grid_max</span>

        <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">section_info</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">SECTION_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">obj_min_cc</span> <span class="o">=</span> <span class="n">section_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">MIN_CC</span><span class="p">)]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">min_cc</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">grid_min_cc</span><span class="p">,</span> <span class="n">obj_min_cc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_cc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">min_cc</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">obj_max_cc</span> <span class="o">=</span> <span class="n">section_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">MAX_CC</span><span class="p">)]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">max_cc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid_max_cc</span><span class="p">,</span> <span class="n">obj_max_cc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_cc</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">max_cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">obj_min_rr</span> <span class="o">=</span> <span class="n">section_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">MIN_RR</span><span class="p">)]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">min_rr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">grid_min_rr</span><span class="p">,</span> <span class="n">obj_min_rr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_rr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">min_rr</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">obj_max_rr</span> <span class="o">=</span> <span class="n">section_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">BBOX</span><span class="o">.</span><span class="n">MAX_RR</span><span class="p">)]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">max_rr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid_max_rr</span><span class="p">,</span> <span class="n">obj_max_rr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_rr</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">max_rr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">min_rr</span><span class="p">,</span> <span class="n">min_cc</span><span class="p">),</span> <span class="p">(</span><span class="n">max_rr</span><span class="p">,</span> <span class="n">max_cc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_section_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal method: get object labels belonging to a grid section.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): Flattened grid section index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[int]: List of object labels assigned to this grid section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">section_info</span> <span class="o">=</span> <span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">grid_info</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">SECTION_NUM</span><span class="p">)]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">section_info</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span></div>

</pre></div>

                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2025, ExFAB BioFoundry.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>