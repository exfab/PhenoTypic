
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>phenotypic.measure._measure_shape &#8212; PhenoTypic</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=800a184d" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=b3db6a4d"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/phenotypic/measure/_measure_shape';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.11.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
     
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/gradient_logo_exfab.svg" class="logo__image only-light" alt="PhenoTypic"/>
    <img src="../../../_static/gradient_logo_exfab.svg" class="logo__image only-dark pst-js-only" alt="PhenoTypic"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api_reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contrib_guide/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../downloadables.html">
    Downloads
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Wheeldon-Lab/PhenoScope#" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api_reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contrib_guide/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../downloadables.html">
    Downloads
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Wheeldon-Lab/PhenoScope#" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">phenotypic.measure._measure_shape</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for phenotypic.measure._measure_shape</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic.tools.constants_</span><span class="w"> </span><span class="kn">import</span> <span class="n">OBJECT</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span> <span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConvexHull</span><span class="p">,</span> <span class="n">qhull</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">distance_transform_edt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">phenotypic.abc_</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeasurementInfo</span><span class="p">,</span> <span class="n">MeasureFeatures</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SHAPE</span><span class="p">(</span><span class="n">MeasurementInfo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The labels and descriptions of the shape measurements.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">category</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Shape&#39;</span>

    <span class="n">AREA</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Area&#39;</span><span class="p">,</span>
            <span class="s2">&quot;Total number of pixels occupied by the microbial colony. Represents colony biomass and growth extent on agar plates. Larger areas typically indicate more robust growth or longer incubation times.&quot;</span><span class="p">)</span>
    <span class="n">PERIMETER</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Perimeter&#39;</span><span class="p">,</span>
                 <span class="s2">&quot;Total length of the colony&#39;s outer boundary in pixels. Measures colony edge complexity and surface irregularity. Smooth, circular colonies have shorter perimeters relative to their area compared to irregular or filamentous colonies.&quot;</span><span class="p">)</span>
    <span class="n">CIRCULARITY</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;Circularity&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;Calculated as :math:`\frac{4\pi*\text</span><span class="si">{Area}</span><span class="s1">}{\text</span><span class="si">{Perimeter}</span><span class="s1">^2}`. Measures how closely a colony approximates a perfect circle (value = 1). Values &lt; 1 indicate irregular colony morphology, which may result from genetic mutations, environmental stress, or mixed microbial populations on agar plates.&#39;</span>
    <span class="p">)</span>
    <span class="n">CONVEX_AREA</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ConvexArea&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Area of the smallest convex polygon that completely contains the colony. Represents the colony</span><span class="se">\&#39;</span><span class="s1">s &quot;filled-in&quot; appearance if all indentations and holes were removed. Useful for detecting colony spreading patterns or invasive growth characteristics.&#39;</span><span class="p">)</span>
    <span class="n">MEDIAN_RADIUS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MedianRadius&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Median distance from colony center to edge across all directions. Provides a robust measure of typical colony size that is less sensitive to outliers than mean radius. Particularly useful for colonies with uneven growth or sectoring.&#39;</span><span class="p">)</span>
    <span class="n">MEAN_RADIUS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MeanRadius&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Average distance from colony center to edge across all directions. Represents overall colony expansion rate. In arrayed growth assays, this correlates with microbial fitness and growth kinetics under controlled conditions.&#39;</span><span class="p">)</span>
    <span class="n">MAX_RADIUS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MaxRadius&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Maximum distance from colony center to edge across all directions. Represents the furthest extent of colony growth from its center. In arrayed microbial assays, this measurement helps identify asymmetric growth patterns or colonies extending toward neighboring positions.&#39;</span><span class="p">)</span>
    <span class="n">MIN_FERET_DIAMETER</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MinFeretDiameter&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Minimum caliper diameter - the shortest distance between two parallel tangent lines touching opposite sides of the colony. Represents the narrowest dimension of the colony regardless of orientation. Useful for detecting elongated or irregular colony morphologies and measuring colony width.&#39;</span><span class="p">)</span>
    <span class="n">MAX_FERET_DIAMETER</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MaxFeretDiameter&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Maximum caliper diameter - the longest distance between two parallel tangent lines touching opposite sides of the colony. Represents the maximum dimension of the colony regardless of orientation. Often exceeds major axis length for irregular shapes and helps quantify maximum colony extent.&#39;</span><span class="p">)</span>
    <span class="n">ECCENTRICITY</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Eccentricity&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Measure of colony elongation, ranging from 0 (perfect circle) to 1 (highly elongated). Values near 0 indicate compact, radially symmetric growth typical of healthy bacterial colonies, while higher values may suggest directional growth, motility, or environmental gradients on the agar surface.&#39;</span><span class="p">)</span>
    <span class="n">SOLIDITY</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Solidity&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Ratio of actual colony area to its convex hull area (Area/ConvexArea). Values near 1 indicate compact, solid colonies with minimal indentations. Lower values (&lt; 0.9) may indicate invasive growth, colony spreading, or the presence of clearing zones around colonies.&#39;</span><span class="p">)</span>
    <span class="n">EXTENT</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Extent&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Ratio of colony area to its bounding box area (ObjectArea/BboxArea). Measures how efficiently the colony fills its allocated space. Compact colonies have higher extent values, while spread-out or irregular colonies have lower values.&#39;</span><span class="p">)</span>
    <span class="n">BBOX_AREA</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;BboxArea&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Area of the smallest rectangle that completely contains the colony. Represents the total spatial footprint of the colony including any empty space. In high-throughput assays, this helps assess colony positioning and potential interference with neighboring colonies.&#39;</span><span class="p">)</span>
    <span class="n">MAJOR_AXIS_LENGTH</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;MajorAxisLength&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Length of the longest axis of the ellipse that best fits the colony shape. Represents the maximum colony dimension. In arrayed microbial growth, this measurement helps identify colonies that have grown beyond their intended grid positions.&#39;</span>
    <span class="p">)</span>
    <span class="n">MINOR_AXIS_LENGTH</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;MinorAxisLength&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Length of the shortest axis of the ellipse that best fits the colony shape. Represents the minimum colony dimension. Together with major axis length, this helps characterize colony aspect ratio and growth anisotropy.&#39;</span>
    <span class="p">)</span>
    <span class="n">COMPACTNESS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;Compactness&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;Calculated as :math:`\frac{\text</span><span class="si">{Perimeter}</span><span class="s1">^2}{4\pi*\text</span><span class="si">{Area}</span><span class="s1">}`. Inverse of circularity (ranges from 1 for perfect circles to higher values for irregular shapes). Measures colony shape complexity - compact, circular colonies have values near 1, while irregular or filamentous colonies have much higher values.&#39;</span>
    <span class="p">)</span>
    <span class="n">ORIENTATION</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Orientation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Angle (in radians) between the colony</span><span class="se">\&#39;</span><span class="s1">s major axis and the horizontal axis. Measures colony alignment and growth directionality. Random orientations are typical for most bacterial colonies, while consistent orientations may indicate environmental gradients or mechanical stresses during plating.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="MeasureShape">
<a class="viewcode-back" href="../../../api_reference/phenotypic.measure.html#phenotypic.measure.MeasureShape">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MeasureShape</span><span class="p">(</span><span class="n">MeasureFeatures</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculates various geometric measures of the objects in the image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A dataframe containing the geometric measures of the objects in the image.</span>

<span class="sd">    References:</span>
<span class="sd">        1. D. R. Stirling, M. J. Swain-Bowden, A. M. Lucas, A. E. Carpenter, B. A. Cimini, and A. Goodman,</span>
<span class="sd">            &quot;CellProfiler 4: improvements in speed, utility and usability,&quot; BMC Bioinformatics, vol. 22, no. 1, p. 433, Sep. 2021, doi: 10.1186/s12859-021-04344-9.</span>
<span class="sd">        2. &quot;Shape factor (image analysis and microscopy),&quot; Wikipedia. Oct. 09, 2021. Accessed: Apr. 08, 2025. [Online].</span>
<span class="sd">            Available: https://en.wikipedia.org/w/index.php?title=Shape_factor_(image_analysis_and_microscopy)&amp;oldid=1048998776</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_feret_diameters</span><span class="p">(</span><span class="n">hull_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate minimum and maximum Feret diameters from convex hull points.</span>
<span class="sd">        </span>
<span class="sd">        The Feret diameter is the distance between two parallel lines tangent to the object.</span>
<span class="sd">        Maximum Feret diameter: longest distance between any two points on the convex hull.</span>
<span class="sd">        Minimum Feret diameter: computed using rotating calipers algorithm to find the </span>
<span class="sd">        minimum width of the object across all orientations.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            hull_points: Nx2 array of coordinates representing convex hull vertices</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (max_feret, min_feret) diameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hull_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="c1"># Maximum Feret: compute pairwise distances and find maximum</span>
        <span class="c1"># This is the straightforward maximum distance between any two hull vertices</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">hull_points</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">hull_points</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">max_feret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

        <span class="c1"># Minimum Feret: use rotating calipers algorithm</span>
        <span class="c1"># For each edge of the convex hull, calculate perpendicular distance to all other points</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hull_points</span><span class="p">)</span>
        <span class="n">min_feret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="c1"># Define edge vector from point i to point i+1</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">hull_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">hull_points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">]</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
            <span class="n">edge_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">edge_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Normalized perpendicular direction to the edge</span>
            <span class="n">edge_unit</span> <span class="o">=</span> <span class="n">edge</span><span class="o">/</span><span class="n">edge_length</span>
            <span class="n">perpendicular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">edge_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge_unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="c1"># Project all hull points onto the perpendicular direction</span>
            <span class="n">projections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hull_points</span> <span class="o">-</span> <span class="n">p1</span><span class="p">,</span> <span class="n">perpendicular</span><span class="p">)</span>

            <span class="c1"># The width in this direction is the range of projections</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
            <span class="n">min_feret</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_feret</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">max_feret</span><span class="p">,</span> <span class="n">min_feret</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_operate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="c1"># Create empty numpy arrays to store measurements</span>
        <span class="n">measurements</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">num_objects</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">SHAPE</span> <span class="k">if</span>
                        <span class="n">feature</span> <span class="o">!=</span> <span class="n">SHAPE</span><span class="o">.</span><span class="n">CATEGORY</span><span class="p">}</span>

        <span class="c1"># Calculate radius-based measurements using distance transform</span>
        <span class="c1"># Distance transform gives the distance from each object pixel to the nearest background pixel</span>
        <span class="n">dist_matrix</span> <span class="o">=</span> <span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:])</span>
        <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MEAN_RADIUS</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_mean</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">dist_matrix</span><span class="p">,</span> <span class="n">objmap</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:])</span>
        <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MEDIAN_RADIUS</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_median</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">dist_matrix</span><span class="p">,</span> <span class="n">objmap</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:])</span>
        <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MAX_RADIUS</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_max</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">dist_matrix</span><span class="p">,</span> <span class="n">objmap</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">objmap</span><span class="p">[:])</span>

        <span class="n">obj_props</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">props</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">obj_image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">objects</span><span class="p">):</span>
            <span class="n">current_props</span> <span class="o">=</span> <span class="n">obj_props</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">AREA</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">area</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">PERIMETER</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">perimeter</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">ECCENTRICITY</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">eccentricity</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">EXTENT</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">extent</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">BBOX_AREA</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">area_bbox</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MAJOR_AXIS_LENGTH</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">major_axis_length</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MINOR_AXIS_LENGTH</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">minor_axis_length</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">ORIENTATION</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">orientation</span>

            <span class="n">numer</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">current_props</span><span class="o">.</span><span class="n">area</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">perimeter</span> <span class="o">**</span> <span class="mi">2</span>

            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">CIRCULARITY</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">numer</span><span class="o">/</span><span class="n">denom</span> <span class="k">if</span> <span class="n">denom</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">COMPACTNESS</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">denom</span><span class="o">/</span><span class="n">numer</span> <span class="k">if</span> <span class="n">numer</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Qhull&#39;</span><span class="p">)</span>
                    <span class="n">convex_hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">current_props</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">qhull</span><span class="o">.</span><span class="n">QhullError</span><span class="p">:</span>
                <span class="n">convex_hull</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">CONVEX_AREA</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">convex_hull</span><span class="o">.</span><span class="n">area</span> <span class="k">if</span> <span class="n">convex_hull</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">SOLIDITY</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">current_props</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="n">convex_hull</span><span class="o">.</span><span class="n">area</span><span class="p">)</span> <span class="k">if</span> <span class="n">convex_hull</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

            <span class="c1"># Calculate Feret diameters using convex hull vertices if available</span>
            <span class="c1"># Feret diameter is the distance between two parallel tangent lines</span>
            <span class="k">if</span> <span class="n">convex_hull</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Get convex hull vertices (actual coordinate points)</span>
                <span class="n">hull_points</span> <span class="o">=</span> <span class="n">current_props</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">convex_hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">]</span>

                <span class="c1"># Maximum Feret: longest distance between any two points on the convex hull</span>
                <span class="n">max_feret</span><span class="p">,</span> <span class="n">min_feret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_feret_diameters</span><span class="p">(</span><span class="n">hull_points</span><span class="p">)</span>
                <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MAX_FERET_DIAMETER</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_feret</span>
                <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MIN_FERET_DIAMETER</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_feret</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MAX_FERET_DIAMETER</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">measurements</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">SHAPE</span><span class="o">.</span><span class="n">MIN_FERET_DIAMETER</span><span class="p">)][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">measurements</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
        <span class="n">measurements</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">OBJECT</span><span class="o">.</span><span class="n">LABEL</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">labels2series</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">measurements</span></div>



<span class="n">MeasureShape</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">SHAPE</span><span class="o">.</span><span class="n">append_rst_to_doc</span><span class="p">(</span><span class="n">MeasureShape</span><span class="p">)</span>
</pre></div>

                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2025, ExFAB BioFoundry.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>